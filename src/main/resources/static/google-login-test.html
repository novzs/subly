<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Google Login Test</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
<h1>Google Login Test</h1>

<div id="g_id_onload"
     data-client_id="1081259194070-mq727mg4rbisdltfim52c2gnijo8lrlq.apps.googleusercontent.com"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="sign_in_with"
     data-shape="rectangular"
     data-logo_alignment="left">
</div>

<div id="result" style="margin-top: 20px; padding: 10px; background-color: #f0f0f0;"></div>

<script>
    function handleCredentialResponse(response) {
        console.log("ID Token: " + response.credential);
        document.getElementById('result').innerHTML = '<p>구글 로그인 성공! ID Token을 받았습니다.</p><p>서버로 전송 중...</p>';

        // Spring Boot API 호출
        fetch('http://localhost:8080/auth/google-login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                idToken: response.credential
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('서버 오류 또는 로그인 실패');
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                document.getElementById('result').innerHTML =
                    '<h3>로그인 성공!</h3>' +
                    '<p>JWT Token: ' + data.token + '</p>' +
                    (data.email ? '<p>Email: ' + data.email + '</p>' : '') +
                    (data.name ? '<p>Name: ' + data.name + '</p>' : '');
            })
            .catch((error) => {
                console.error('Error:', error);
                document.getElementById('result').innerHTML =
                    '<p style="color: red;">로그인 실패: ' + error.message + '</p>';
            });
    }
</script>
</body>
</html>
